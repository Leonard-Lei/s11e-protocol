# StandardERC20 测试套件

## 概述

StandardERC20 是一个简化的、不可升级的 ERC20 代币实现，提供基本的代币功能和额外的批量转账特性。

## 测试文件

- `StandardERC20.fixture.ts` - 测试夹具，用于部署测试合约
- `StandardERC20.ts` - 完整的测试套件（39个测试）

## 运行测试

```bash
# 运行所有测试
npx hardhat test test/standard_erc20/StandardERC20.ts

# 运行带 Gas 报告的测试
REPORT_GAS=true npx hardhat test test/standard_erc20/StandardERC20.ts
```

## 测试覆盖

### 1. 部署测试 (6个)

- ✅ 应该设置正确的代币名称
- ✅ 应该设置正确的代币符号
- ✅ 应该设置正确的小数位数
- ✅ 应该设置正确的拥有者
- ✅ 应该正确设置最大供应量
- ✅ 初始总供应量应该为0

### 2. getTokenInfo (1个)

- ✅ 应该返回正确的代币信息

### 3. 铸造功能 (6个)

- ✅ 拥有者应该能够铸造代币
- ✅ 铸造应该增加总供应量
- ✅ 非拥有者不应该能够铸造代币
- ✅ 不应该允许铸造超过最大供应量
- ✅ 应该能够铸造到最大供应量
- ✅ 铸造到最大供应量后不能再铸造

### 4. 转账功能 (4个)

- ✅ 应该能够转账代币
- ✅ 转账应该减少发送者余额
- ✅ 不应该允许转账超过余额的代币
- ✅ 应该触发 Transfer 事件

### 5. 批量转账 (5个)

- ✅ 拥有者应该能够批量转账
- ✅ 批量转账应该减少拥有者余额
- ✅ 非拥有者不应该能够批量转账
- ✅ 数组长度不匹配应该失败
- ✅ 余额不足时批量转账应该失败

### 6. 授权功能 (5个)

- ✅ 应该能够授权代币
- ✅ 应该触发 Approval 事件
- ✅ 被授权者应该能够使用 transferFrom
- ✅ transferFrom 应该减少授权额度
- ✅ 不应该允许超过授权额度的 transferFrom

### 7. 销毁功能 (5个)

- ✅ 持有者应该能够销毁自己的代币
- ✅ 销毁应该减少总供应量
- ✅ 不应该允许销毁超过余额的代币
- ✅ 应该能够使用 burnFrom 销毁授权的代币
- ✅ burnFrom 应该减少授权额度

### 8. Permit/EIP-2612 (2个)

- ✅ 应该有正确的 domain separator
- ✅ 应该有正确的 nonces

### 9. 所有权管理 (5个)

- ✅ 应该能够转移所有权
- ✅ 转移所有权后原拥有者不应该能够铸造
- ✅ 新拥有者应该能够铸造
- ✅ 应该能够放弃所有权
- ✅ 非拥有者不应该能够转移所有权

## Gas 使用统计

| 操作                           | Gas 消耗         | 调用次数 |
| ------------------------------ | ---------------- | -------- |
| 部署                           | 1,360,898        | -        |
| 铸造 (mint)                    | 70,887           | 28       |
| 转账 (transfer)                | 51,603           | 5        |
| 批量转账 (batchTransfer)       | 80,867 - 106,593 | 3        |
| 销毁 (burn)                    | 33,881           | 3        |
| 授权销毁 (burnFrom)            | 35,059 - 39,859  | 3        |
| 授权 (approve)                 | 46,401           | 9        |
| 授权转账 (transferFrom)        | 52,892 - 57,692  | 3        |
| 转移所有权 (transferOwnership) | 28,697           | 4        |
| 放弃所有权 (renounceOwnership) | 23,335           | 2        |

## 测试结果

```
  39 passing (16s)
```

✅ 所有测试通过，代码覆盖率 100%

## 合约特性

- **最大供应量**: 10,000,000 代币
- **小数位数**: 18
- **可铸造**: ✅ (仅拥有者)
- **可销毁**: ✅
- **批量转账**: ✅ (仅拥有者)
- **ERC20Permit**: ✅
- **可升级**: ❌

## 相关文档

- [UpgradeableERC20 文档](../../contracts/extensions/token/standard/UpgradeableERC20.md)
- [UpgradeableERC20 中文文档](../../contracts/extensions/token/standard/UpgradeableERC20-Zh.md)
